#!/usr/bin/env python3
"""
Daily study dashboard - CLI version.

Shows today's domain, reviewer status, and next task.
This is the CLI equivalent of the TUI dashboard.
"""
import datetime
from pathlib import Path

# Import from shared data layer
from reviewer.core import (
    get_todays_domain,
    get_next_task,
    get_reviewer_summary,
    get_overall_progress,
    collect_focus_files,
)

# ANSI Colors
BOLD = '\033[1m'
GREEN = '\033[32m'
YELLOW = '\033[33m'
CYAN = '\033[36m'
DIM = '\033[2m'
RESET = '\033[0m'


def print_header():
    date_str = datetime.date.today().strftime("%A, %B %d, %Y")
    print(f"{BOLD}╔════════════════════════════════════════╗{RESET}")
    print(f"{BOLD}║           TODAY'S STUDY PLAN           ║{RESET}")
    print(f"{BOLD}║  {CYAN}{date_str:<26}{RESET}{BOLD}     ║{RESET}")
    print(f"{BOLD}╚════════════════════════════════════════╝{RESET}")
    print()


def print_domain():
    domain, override = get_todays_domain()
    
    if override:
        print(f"{BOLD}Current Phase:{RESET} {YELLOW}{domain}{RESET}")
        print(f"{DIM}{override}{RESET}")
    else:
        print(f"{BOLD}Domain:{RESET} {GREEN}{domain}{RESET}")
    print()


def print_reviewer_status():
    print(f"{BOLD}Reviewer:{RESET}")
    
    try:
        summary = get_reviewer_summary()
        
        box_zero = summary["box_zero"]
        overdue = summary["overdue"]
        due_now = summary["due_now"]
        never_practiced = summary["never_practiced"]
        total_due = box_zero + overdue + due_now
        
        if box_zero > 0:
            print(f"  {YELLOW}Box 0 (failed): {box_zero} cards{RESET}")
        if overdue > 0:
            print(f"  {YELLOW}Overdue: {overdue} cards{RESET}")
        if due_now > 0:
            print(f"  {GREEN}Due now: {due_now} cards{RESET}")
        if total_due == 0:
            print(f"  {GREEN}All caught up!{RESET}")
        if never_practiced > 0:
            print(f"  {DIM}Never practiced: {never_practiced} cards{RESET}")
        
        if summary["last_practiced"]:
            # Show just the date portion
            last_date = summary["last_practiced"][:10]
            print(f"  {DIM}Last practiced: {last_date}{RESET}")
            
    except Exception as e:
        print(f"  {DIM}(error reading reviewer data: {e}){RESET}")
    
    print()


def print_card_summary():
    focus_files = collect_focus_files()
    count = len(focus_files)
    
    if count > 0:
        print(f"{BOLD}Reviewer Library:{RESET}")
        print(f"  {DIM}Focus cards: {count}{RESET}")
        print()


def print_next_task():
    done, total = get_overall_progress()
    if total == 0:
        return

    print(f"{BOLD}Phase 0 Progress:{RESET} {done}/{total} tasks complete")

    next_task = get_next_task()
    if next_task:
        print(f"  {CYAN}Next:{RESET}  {next_task}")
    else:
        print(f"  {GREEN}All Phase 0 tasks complete!{RESET}")

    print()


def print_quick_commands():
    print(f"{BOLD}Quick Commands:{RESET}")
    print(f"  {GREEN}./study{RESET}                  # Launch TUI (recommended)")
    print(f"  {GREEN}./drill{RESET}                  # Drill due cards (Textual TUI)")
    print(f"  {DIM}./study --progress{RESET}       # Generate progress report")
    print()


def main():
    print_header()
    print_domain()
    print_reviewer_status()
    print_card_summary()
    print_next_task()
    print_quick_commands()


if __name__ == "__main__":
    main()
